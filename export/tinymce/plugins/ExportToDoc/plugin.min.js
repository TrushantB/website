tinymce.PluginManager.add('ExportToDoc', function(editor, url) {
  editor.addButton('ExportToDoc', {
    text: "Export to Doc",
    icon: false,
    onclick: function() {
      var fileName = editor.getParam('etd_file_name')?editor.getParam('etd_file_name'):'tinymce-content';
      fileName = fileName+'.doc';
      var preHtml = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>TinyMCE Export To Doc</title></head><body>";
      var postHtml = "</body></html>";
      var elHtml = preHtml+editor.getContent()+postHtml;
      var link = document.createElement('a');
      var mimeType = 'application/vnd.ms-word';
      
      document.body.appendChild(link);
      
      if (navigator.msSaveOrOpenBlob){
        var blob = new Blob(['\ufeff', elHtml], {
          type: 'application/msword'
        });
        navigator.msSaveOrOpenBlob( blob, fileName);
      }else{
        link.setAttribute('download', fileName);
        link.setAttribute('href', 'data:' + mimeType  +  ';charset=utf-8,' + encodeURIComponent(elHtml));
        link.click();
      }
    }
  });
});